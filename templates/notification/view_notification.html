{% extends "layout.html" %}
{% load static %}

{% block stylesheet %}<link rel="stylesheet" href="{% static 'css/notification.css'%}">{% endblock stylesheet %}

{% block content %}
<div class="row m-3">
    <!-- Notification List Column -->
    <div class="col-3">
        <div class="card shadow">
            <div class="card-body p-3">
                <h5 class="card-title">Notifications</h5>
                <hr class="my-2">
                
                <!--Paginator-->
                <nav class="my-3">
                    <ul class="pagination justify-content-center pagination-clean">
                        {% if notifications.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?noti={{selected_notification.id}}&page={{ notifications.previous_page_number }}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        {% endif %}

                        {% with notifications.number|add:"-2" as start_page %}
                        {% with notifications.number|add:"2" as end_page %}
                        {% for num in notifications.paginator.page_range %}
                        {% if num >= start_page and num <= end_page %}
                        <li class="page-item {% if notifications.number == num %}active{% endif %}">
                            <a class="page-link" href="?noti={{selected_notification.id}}&page={{ num }}">{{ num }}</a>
                        </li>
                        {% endif %}
                        {% endfor %}
                        {% endwith %}
                        {% endwith %}

                        {% if notifications.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?noti={{selected_notification.id}}&page={{ notifications.next_page_number }}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                
                {% for noti in notifications %}
                <a href="{% url 'view_notification' %}?noti={{ noti.id }}&page={{ page_number }}" class="text-decoration-none text-dark">
                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom shadow-hover">
                        <span>{{ noti.title }}</span>
                        {% if not noti.status %}
                        <!-- Red dot for unread notifications -->
                        <span class="badge bg-danger mx-3" style="width: 10px; height: 10px; border-radius: 50%;">.</span>
                        {% endif %}
                    </div>
                </a>
                {% empty %}
                    <p>No notifications available.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Notification Details Column -->
    <div class="col-9">
        <div class="card shadow">
            <div class="card-body p-3">
                {% if selected_notification %}
                    <h2>{{ selected_notification.title }}</h2>
                    <p class="text-muted">{{ selected_notification.timestamp }}</p>
                    <hr>
                    <div class="p-3 border rounded-1">
                        <p>{{ selected_notification.message|linebreaksbr }}</p>
                    </div>                    
                    <div class="my-3 d-flex justify-content-end">
                        <a href="{% url 'mark_unread' selected_notification.id %}" class="btn btn-primary mx-3">Mark as Unread</a>
                        <a href="{% url 'delete_notification' selected_notification.id %}" class="btn btn-danger mx-3" onclick="return confirmDelete();">Delete Notification</a>
                    </div>
                {% else %}
                <div class="d-flex justify-content-center">
                    <p>Select A notification to view</p>
                </div>     
                {% endif %}
            </div>
        </div>
    </div>
</div>


{% endblock content %} 

{% block script %}
<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this notification?");
    }
</script>
{% endblock script %}